!function(){"use strict";const e={body:document.querySelector("body"),errorModal:document.querySelector(".error-modal"),errorModalContent:document.querySelector(".error-modal__content"),themeContainer:document.querySelector(".header__theme-cont"),themeLight:document.querySelector(".theme--light"),themeDark:document.querySelector(".theme--dark"),navbarForm:document.querySelector(".navbar__form"),backBtn:document.querySelector(".backbtn"),searchBoxId:document.querySelector("#js-countrySearchbox"),searchBoxClass:document.querySelector(".searchbox"),searchboxCont:document.querySelector(".searchbox__cont"),searchboxCloseIcon:document.querySelector(".searchbox__icon--close"),searchboxSubmit:document.querySelector(".searchbox__submit"),searchboxListCont:document.querySelector(".searchbox__list-cont"),searchboxList:document.querySelector(".searchbox__list"),dropdownbox:document.querySelector(".dropdown-box"),dropdownboxSelected:document.querySelector(".dropdown-box__selected"),dropdownboxListCont:document.querySelector(".dropdown-box__list-cont"),dropdownboxIcon:document.querySelector(".dropdown-box__icon"),main:document.querySelector(".main"),mainCont:document.querySelector(".main__cont"),country:document.querySelector(".country"),countryDetailModal:document.querySelector(".country-detail"),countryDetailModalCloseBtn:document.querySelector(".country-detail__cross")},t={heading:document.querySelector(".country-detail__heading"),flagImg:document.querySelector(".country-detail__img"),nativeName:document.querySelector(".js-country-native-name"),population:document.querySelector(".js-country-population"),region:document.querySelector(".js-country-region"),subRegion:document.querySelector(".js-country-sub-region"),capital:document.querySelector(".js-country-capital"),topLevelDomain:document.querySelector(".js-country-top-level-domain"),currencies:document.querySelector(".js-country-currencies"),languages:document.querySelector(".js-country-languages"),borderCountries:document.querySelector(".country-detail__border-countries"),noBorderCountriesText:document.querySelector(".country-detail__border--none-text"),borderCountriesList:document.querySelector(".country-detail__border-countries__list")};function n(){var t,n,r;null===(t=e.body)||void 0===t||t.classList.toggle("dark-mode"),null===(n=e.themeDark)||void 0===n||n.classList.toggle("hidden"),null===(r=e.themeLight)||void 0===r||r.classList.toggle("hidden"),function(){try{var t;(null===(t=e.body)||void 0===t?void 0:t.classList.contains("dark-mode"))?localStorage.setItem("darkMode","true"):localStorage.setItem("darkMode","false")}catch(e){}}()}function r(){var t;window.matchMedia("(prefers-color-scheme)")&&window.matchMedia("(prefers-color-scheme: dark)")&&!(null===(t=e.body)||void 0===t?void 0:t.classList.contains("dark-mode"))&&n()}function o(e,t){"string"==typeof t?localStorage.setItem(e,t):localStorage.setItem(e,JSON.stringify(t))}function a(e,t=!1){let n;const r=localStorage.getItem(e);return r?(n=t?JSON.parse(r):r,n):null}function i(){const t=e.body;if(!t)throw new Error("No body element found for bodyBlur");t.classList.add("blur-background")}function s(){const t=e.body;if(!t)throw new Error("No body element found for bodyBlur");t.classList.remove("blur-background")}function c(){const t=e.body;if(!t)throw new Error("No body element found for bodyBlur");t.classList.toggle("blur-background")}const l="https://restcountries.com/v3.1/all",d="allRegions";function u(e,t,n,r,o,a,i){try{var s=e[a](i),c=s.value}catch(e){return void n(e)}s.done?t(c):Promise.resolve(c).then(r,o)}function h(e){return function(){var t=this,n=arguments;return new Promise((function(r,o){var a=e.apply(t,n);function i(e){u(a,r,o,i,s,"next",e)}function s(e){u(a,r,o,i,s,"throw",e)}i(void 0)}))}}const p={allCountriesMap:new Map,africaMap:new Map,americasMap:new Map,asiaMap:new Map,europeMap:new Map,oceaniaMap:new Map,miscRegionMap:new Map,countriesNameMap:new Map,rawCountriesData:void 0},m="countriesLocalData",g="isDataPreSorted";function w(e){for(const t of e)switch(p.allCountriesMap.set(t.cca3,t),p.countriesNameMap.set(t.name.common.toLowerCase(),t),t.region){case"Africa":p.africaMap.set(t.cca3,t);break;case"Americas":p.americasMap.set(t.cca3,t);break;case"Asia":p.asiaMap.set(t.cca3,t);break;case"Europe":p.europeMap.set(t.cca3,t);break;case"Oceania":p.oceaniaMap.set(t.cca3,t);break;default:p.miscRegionMap.set(t.cca3,t)}}function f(){return b.apply(this,arguments)}function b(){return(b=h((function*(){try{if("true"===a(g))return;const e=p.rawCountriesData;if(!e)return;e.sort(((e,t)=>e.name.common>t.name.common?1:e.name.common<t.name.common?-1:0)),v(),o(g,"true")}catch(e){throw e}}))).apply(this,arguments)}function v(){if(!p.rawCountriesData)throw new Error("No country data available from API");o(m,p.rawCountriesData)}function y(){return _.apply(this,arguments)}function _(){return(_=h((function*(){try{const e=yield fetch(l);if(200!==e.status)throw new Error("'Coudn't connect to REST API '");const t=yield e.json();p.rawCountriesData=t}catch(e){throw e}}))).apply(this,arguments)}function x(){return E.apply(this,arguments)}function E(){return(E=h((function*(){try{const e=a(m,!0);e?p.rawCountriesData=e:(yield y(),v())}catch(e){throw e}}))).apply(this,arguments)}class L{clearParentElement(){if(!this.parentElement)throw new Error("No valid parentElement found");this.parentElement.innerHTML=""}renderSpinner(e=this.parentElement){if(!e)throw new Error("No valid parentElement found");this.clearParentElement(),e.insertAdjacentHTML("afterbegin",'<div class="spinner">\n    <div class="spinner-cont">\n      <span class="material-icons spinner-icon">sync</span>\n    </div>\n  </div>')}hideErrorWhenClickedOutsideOnce(){const t=e.body;if(!t)throw new Error("No body elem found");t.addEventListener("click",this.hideErrorModal,{once:!0})}showErrorModal(t=!1){const n=e.errorModal;if(!n)throw new Error("No error modal found");try{t&&i(),n.classList.remove("hidden")}catch(e){this.renderError(e.message)}}hideErrorModal(){const t=e.errorModal;if(!t)throw new Error("No error modal found");try{s(),t.classList.add("hidden")}catch(e){this.renderError(e.message)}}renderError(t,n=!0,r=!1,o=this.parentElement){try{i();const a=e.errorModalContent;if(!a)throw new Error("Can't find errorContent");if(r){if(!o)throw new Error(`Can't find ${o} to clear innerHTml`);o.innerHTML=""}a.innerHTML=t,this.showErrorModal(n)}catch(e){this.renderError(e.message)}}constructor(){this.parentElement=e.body}}class C extends L{genListSeperatedVals(e,t){if(!e)return t;let n="";for(const t of e)n+=`${t}, `;return n.slice(0,n.length-2)}getCurrencies(e,t="No currency"){if(!e||Object.entries(e).length<1)return t;let n="";for(const t in e)Object.prototype.hasOwnProperty.call(e,t)&&(n+=`${e[t].name}, `);return n.slice(0,n.length-2)}getLanguages(e,t="No language"){if(!e||Object.entries(e).length<1)return t;let n="";for(const t in e)Object.prototype.hasOwnProperty.call(e,t)&&(n+=`${e[t]}, `);return n.slice(0,n.length-2)}getNativeName(e,t="No native name"){if(!e||Object.entries(e).length<1)return t;let n="";for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t)){n+=e[t].official;break}return n}getPopulation(e){let t="";return t=e<1e5?e.toString():`${(e/1e6).toFixed(2)}`,t}prettifyNumbers(e){let t=e.toString(),n=3;return e>=1e3&&(t=t.slice(0,-n)+","+t.slice(-n)),e>=1e6&&(n+=4,t=t.slice(0,-n)+","+t.slice(-n)),e>=1e9&&(n+=4,t=t.slice(0,-n)+","+t.slice(-n)),t}}var S=new class extends C{getPopulation(e){const t=1e9;let n="";return e<1e5?(n=this.prettifyNumbers(e),n+="</span>"):e>t?(n=`${(e/t).toFixed(2)}`,n+='</span><span class="country__content__postfix"> B </span>'):(n=`${(e/1e6).toFixed(2)}`,n+='</span><span class="country__content__postfix"> M </span>'),n}capitalFormatter(e){if(!e)return"No capital";const t=e.length;let n="";return n=0===t?"No capital":1===t?e[0]:`${e[0]}, ...`,n}generateHtmlMarkup(e){return` <article class="country" data-cca3=${e.cca3}>\n  <div class="country__cont">\n    <div class="country__img-cont">\n      <img\n        src="${e.flags.svg}"\n        alt="${e.name.common} flag"\n        class="country__img"\n      />\n    </div>\n    <div class="country__content-cont">\n      <h1 class="country__title">${e.name.common}</h1>\n\n      <p class="country__content">\n        <span class="material-icons country__icon">people</span>\n        <span class="country__content__title">Population: </span>\n        <span class="country__content__result">\n        ${this.getPopulation(e.population)}\n      </p>\n      <p class="country__content">\n        <span class="material-icons country__icon">travel_explore</span>\n        <span class="country__content__title">Region: </span>\n        <span class="country__content__result country__content__result--region">${e.region}</span>\n      </p>\n      <p class="country__content">\n        <span class="material-icons country__icon">festival</span>\n        <span class="country__content__title">Capital: </span>\n        <span class="country__content__result">${this.capitalFormatter(e.capital)}</span>\n      </p>\n    </div>\n  </div>\n</article>`}render(e){try{if(!this.parentElement)throw new Error("No valid parent element in countryCard");let t;if(this.clearParentElement(),e instanceof Map)for(const[n,r]of e)t=this.generateHtmlMarkup(r),this.parentElement.insertAdjacentHTML("beforeend",t);else if(e instanceof Array)for(const n of e)t=this.generateHtmlMarkup(n),this.parentElement.insertAdjacentHTML("beforeend",t);else t=this.generateHtmlMarkup(e),this.parentElement.insertAdjacentHTML("beforeend",t)}catch(e){throw e}}constructor(...t){super(...t),this.parentElement=e.mainCont}};function M(){S.renderSpinner()}function k(e,t=!0){S.renderError(e,t)}function N(e){try{S.render(e)}catch(e){k(e.message)}}var D=new class extends C{hideErrorBox(){s(),this.hideErrorModal()}hideDetailedView(t){t.stopPropagation();const n=t.target,r=null==n?void 0:n.closest(".country-detail"),o=null==n?void 0:n.closest(".country-detail__cross");var a,i;r&&!o||(this.hideErrorBox(),null===(a=e.countryDetailModal)||void 0===a||a.classList.add("hidden"),null===(i=e.body)||void 0===i||i.removeEventListener("click",this.viewState.hideDetailedViewInstance))}toggleDetailedView(){var t;c(),null===(t=e.countryDetailModal)||void 0===t||t.classList.toggle("hidden")}renderDetailView(e){if(!e.dataset.cca3)throw new Error("No valid country code to view detailed information");if(!this.countriesMap)throw new Error("No allCountriesMap found");const t=this.countriesMap.get(e.dataset.cca3);if(!t)throw new Error(`Cannot find any country with country code ${e.dataset.cca3}`);this.generateMarkup(t)}showDetailedView(t){try{var n;const r=t.target,o=null==r?void 0:r.closest(".country");if(!o)return;t.stopPropagation(),this.renderDetailView(o),this.toggleDetailedView(),null===(n=e.body)||void 0===n||n.addEventListener("click",this.viewState.hideDetailedViewInstance)}catch(t){var r;c(),this.renderError(t.message),null===(r=e.body)||void 0===r||r.addEventListener("click",this.viewState.hideDetailedViewInstance)}}switchDetailedView(e){e.stopPropagation();const t=e.target,n=null==t?void 0:t.closest(".country-detail__border-country");n&&this.renderDetailView(n)}genAvailableBorders(e,t){if(!e)return[!1,""];let n="";for(const o of e){var r;const e=null===(r=t.get(o))||void 0===r?void 0:r.name.common;n+=`<li class="country-detail__border-country" data-cca3=${o}>${null!=e?e:o}</li>`}return[!0,n]}generateMarkup(e){try{if(!this.countriesMap)throw new Error("No valid countryMap data");const r=t.heading,o=t.flagImg,a=t.nativeName,i=t.population,s=t.region,c=t.subRegion,l=t.capital,d=t.topLevelDomain,u=t.currencies,h=t.languages,p=t.borderCountriesList,m=t.noBorderCountriesText;if(!(r&&o&&a&&i&&s&&c&&l&&d&&u&&h&&p&&m))throw new Error("Error generating correct markup for detailed country view modal");var n;r.innerText=e.name.common,o.setAttribute("src",e.flags.svg),o.setAttribute("alt",`${e.name.common} flag`),a.innerText=this.getNativeName(e.name.nativeName),i.innerText=this.prettifyNumbers(e.population),s.innerText=e.region,c.innerText=null!==(n=e.subregion)&&void 0!==n?n:"No subregion",l.innerText=this.genListSeperatedVals(e.capital,"No capital"),d.innerText=this.genListSeperatedVals(e.tld,"No TLD"),u.innerText=this.getCurrencies(e.currencies),h.innerText=this.getLanguages(e.languages);const g=this.genAvailableBorders(e.borders,this.countriesMap);g[0]?(p.classList.remove("hidden"),m.classList.add("hidden"),p.innerHTML=g[1]):(p.classList.add("hidden"),m.classList.remove("hidden"))}catch(e){this.renderError(e.message)}}render(n){try{var r,o;this.countriesMap=n,null===(r=e.mainCont)||void 0===r||r.addEventListener("click",this.viewState.showDetailedViewInstance),null===(o=t.borderCountriesList)||void 0===o||o.addEventListener("click",this.viewState.switchDetailedViewInstance)}catch(e){throw e}}constructor(...t){super(...t),this.parentElement=e.countryDetailModal,this.viewState={showDetailedViewInstance:this.showDetailedView.bind(this),switchDetailedViewInstance:this.switchDetailedView.bind(this),hideDetailedViewInstance:this.hideDetailedView.bind(this)}}};function B(e){D.render(e)}var I=new class extends L{showCloseIcon(){const t=e.searchboxCloseIcon;if(!t)throw new Error("No close btn found in searchbox");t.classList.remove("hidden")}autoSuggest(){var t;const n=e.searchBoxId;if(!n)throw new Error("No searchbox found");if(!n.value)return;const r=e.searchboxList;if(!r)throw new Error("No list to update");const o=n.value.toLowerCase();let a=0;for(const e of r.childNodes)e.innerText.toLowerCase().indexOf(o)>=0?(e.classList.remove("hidden"),a++):e.classList.add("hidden");var i;a<1?null===(i=e.searchboxListCont)||void 0===i||i.classList.add("hidden"):null===(t=e.searchboxListCont)||void 0===t||t.classList.remove("hidden")}hideSearchSuggestions(){const t=e.searchboxListCont;if(!t)throw new Error("Cannot find serachbox suggestions list cont");t.classList.add("visually-hidden")}toggleSearchSuggestions(t){const n=e.searchboxListCont;if(!n)throw new Error("Cannot find searchbox suggestions list cont");t.stopPropagation();const r=e.searchBoxId;if(!r)throw new Error("No searchbox found");r.value.trim()?(this.showCloseIcon(),this.showSubmitBtn(),n.classList.remove("visually-hidden")):(this.hideCloseIcon(),this.hideSubmitBtn(),n.classList.add("visually-hidden"))}searchboxKeyUpHandler(e){"enter"!==e.key.toLowerCase()?(this.toggleSearchSuggestions(e),this.autoSuggest()):this.hideSearchSuggestions()}submitBtnHandler(t){var n;t.preventDefault(),t.stopPropagation();const r=new Event("submit",{bubbles:!1,cancelable:!0});null===(n=e.navbarForm)||void 0===n||n.dispatchEvent(r)}showSubmitBtn(){const t=e.searchboxSubmit;if(!t)throw new Error("No searchbox submit btn");t.classList.remove("hidden")}hideSubmitBtn(){const t=e.searchboxSubmit;if(!t)throw new Error("No searchbox submit btn");t.classList.add("hidden")}hideCloseIcon(){const t=e.searchboxCloseIcon;if(!t)throw new Error("No close btn found in searchbox");t.classList.add("hidden"),this.searchboxValue=""}hideCloseIconHandler(t){const n=e.searchboxCloseIcon;if(!n)throw new Error("No close btn found in searchbox");n.addEventListener("click",t)}showBackBtn(){const t=e.backBtn;if(!t)throw new Error("No valid backBtn found");t.classList.remove("hidden")}hideBackBtn(){const t=e.backBtn;if(!t)throw new Error("No valid backBtn found");t.classList.add("hidden")}backBtnClickHandler(t){const n=e.backBtn;if(!n)throw new Error("No valid backBtn found");n.addEventListener("click",t)}get searchboxValue(){const t=e.searchBoxId;if(!t)throw new Error("No searchbox found");return t.value.toLowerCase()}set searchboxValue(t){const n=e.searchBoxId;if(!n)throw new Error("No searchbox found");n.value=t}submitHandler(t){const n=e.navbarForm;if(!n)throw new Error("No valid Navbar form element");n.addEventListener("submit",t)}searchboxSuggestionHandler(t){const n=e.searchboxList;if(!n)throw new Error("Cannot find serachbox suggestions list");n.addEventListener("click",t)}resetSearchHandler(t){const n=e.searchBoxId;if(!n)throw new Error("No searchbox found");n.addEventListener("input",t)}generateSearchSuggestions(t){const n=e.searchboxList;if(!n)throw new Error("No htmlELement list found for inserting search suggestions");n.innerHTML="";let r="";for(const[e,n]of t)r+=`<li class="searchbox__list-item" data-cca3="${e}">${n.name.common}</li>`;n.innerHTML=r}render(){try{const t=e.searchboxCont;if(!t)throw new Error("Cannot find searchbox cont");const n=e.body;if(!n)throw new Error("Cannot find body");const r=e.searchboxSubmit;if(!r)throw new Error("Cannot find submit btn");t.addEventListener("keyup",this.searchboxKeyUpHandler.bind(this)),n.addEventListener("click",this.hideSearchSuggestions),r.addEventListener("click",this.submitBtnHandler)}catch(e){throw e}}},q=new class{hideDropdownList(){var t,n;null===(t=e.dropdownboxListCont)||void 0===t||t.classList.add("visually-hidden"),null===(n=e.dropdownboxIcon)||void 0===n||n.classList.remove("dropdown-box__icon--active")}toggleDropdownList(t){var n,r,o;null===(n=e.dropdownboxIcon)||void 0===n||n.classList.toggle("dropdown-box__icon--active"),null===(r=e.dropdownboxListCont)||void 0===r||r.classList.toggle("visually-hidden"),t.stopPropagation(),null===(o=e.body)||void 0===o||o.addEventListener("click",this.hideDropdownList)}updateSelectedValue(t,n){const r=e.dropdownboxSelected;if(!r)throw new Error("Can't get the current selected value in filter box");r.innerText=t,r.dataset.region=n}dropdownListClickHandler(t){var n;null===(n=e.dropdownboxListCont)||void 0===n||n.addEventListener("click",t)}getCurrentRegionDataset(){const t=e.dropdownboxSelected;if(!t)throw new Error("No selected region found");const n=t.dataset.region;return""===n?d:n}render(){var t;null===(t=e.dropdownbox)||void 0===t||t.addEventListener("click",this.viewState.toggleDropdownList)}constructor(){this.viewState={toggleDropdownList:this.toggleDropdownList.bind(this)}}};function V(e){if(!e)throw new Error("Not a valid string");switch(e){case d:return p.allCountriesMap;case"africa":return p.africaMap;case"americas":return p.americasMap;case"asia":return p.asiaMap;case"europe":return p.europeMap;case"oceania":return p.oceaniaMap;case"antarctic":return p.miscRegionMap;default:throw new Error("Cannot find any appropriate map")}}const H={currRegion:d};function T(e){const t=e.target,n=null==t?void 0:t.closest(".dropdown-box__list-item");if(!n)return;const r=q.getCurrentRegionDataset(),o=n.innerText,a=n.dataset.region;if(!a)throw new Error("Can't find any dataset value on the selected option");if(r!==a){q.updateSelectedValue(o,a),H.currRegion=a;const e=V(a);S.render(e),A(),function(e){I.generateSearchSuggestions(e)}(e)}}function $(){q.render(),q.dropdownListClickHandler(T)}const P={searchCausedViewChange:!1,partialmatchedResultsArr:[]};function A(){if(I.hideCloseIcon(),I.hideSubmitBtn(),I.hideSearchSuggestions(),I.searchboxValue="",P.searchCausedViewChange){I.hideBackBtn(),P.searchCausedViewChange=!1;const e=V(q.getCurrentRegionDataset());S.render(e)}}function j(){""===I.searchboxValue&&P.searchCausedViewChange&&A()}function O(e){var t;const n=e.target.closest(".searchbox__list-item");if(!n)return;const r=null===(t=n.dataset)||void 0===t?void 0:t.cca3;if(!r)throw new Error("Can't find appropriate cca3 code from searchbox suggestion");const o=p.allCountriesMap.get(r);if(!o)throw new Error("No valid country found with the code");I.searchboxValue=o.name.common,S.render(o),I.showBackBtn(),P.searchCausedViewChange=!0}function R(e){e.preventDefault();try{P.partialmatchedResultsArr.length=0;const e=I.searchboxValue;if(!e||""===e)return;const n=H.currRegion,r=V(n),o=p.countriesNameMap.get(e);for(const[,t]of r)t.name.common.toLowerCase().indexOf(e)>=0&&P.partialmatchedResultsArr.push(t);if(!o&&P.partialmatchedResultsArr.length<1){let t=`No valid country found\n       with the name <strong>${e}</strong>. `;return n!==d&&(t+="Maybe try changing region"),I.renderError(t),void I.hideErrorWhenClickedOutsideOnce()}var t;if((null==o?void 0:o.region.toLowerCase())!==n&&n!==d&&P.partialmatchedResultsArr.length<1)return I.renderError(`No valid country found, named <em><strong>${e}</strong></em> \n         in the region <strong>${n}</strong>.\n         Maybe try selecting \n         <strong>${null!==(t=null==o?void 0:o.region.toLowerCase())&&void 0!==t?t:"All regions"}</strong> as the region.`),void I.hideErrorWhenClickedOutsideOnce();S.render(P.partialmatchedResultsArr),I.showBackBtn(),P.searchCausedViewChange=!0}catch(e){}}function F(){I.generateSearchSuggestions(p.allCountriesMap),I.searchboxSuggestionHandler(O),I.render(),I.submitHandler(R),I.resetSearchHandler(j),I.hideCloseIconHandler(A),I.backBtnClickHandler(A)}function W(e,t,n,r,o,a,i){try{var s=e[a](i),c=s.value}catch(e){return void n(e)}s.done?t(c):Promise.resolve(c).then(r,o)}function J(e){return function(){var t=this,n=arguments;return new Promise((function(r,o){var a=e.apply(t,n);function i(e){W(a,r,o,i,s,"next",e)}function s(e){W(a,r,o,i,s,"throw",e)}i(void 0)}))}}function K(){return(K=J((function*(){try{var t;if(M(),yield x(),!p.rawCountriesData)throw new Error("No country data available");f(),w(p.rawCountriesData),N(p.allCountriesMap),B(p.allCountriesMap),$(),F(),null===(t=e.themeContainer)||void 0===t||t.addEventListener("click",(e=>e.stopPropagation()))}catch(e){k(e.message,!1)}}))).apply(this,arguments)}!function(){var t;try{const e=localStorage.getItem("darkMode");null===e?r():"true"===e&&n()}catch(e){r()}null===(t=e.themeContainer)||void 0===t||t.addEventListener("click",n)}(),function(){K.apply(this,arguments)}()}();